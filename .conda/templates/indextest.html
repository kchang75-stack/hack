<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mad Snacks</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylestest.css') }}" />
</head>

<body>
    <h1 style="font-family: 'Courier New', Courier, monospace;">MAD SNacks</h1>

    <div id="navbar">
        <!-- <a>LINK ONE</a>
        <a>LINK TWO</a>
        <a>LINK THREE</a>
        <a>LINK FOUR</a>
        <a>LINK FIVE</a> -->
    </div>

    <div id="searchContainer">
        <input
            type="text"
            id="searchIntake"
            placeholder="apple, orange, steak"
        />
        <button onclick="searchGrocery()">Search</button>
    </div>

    <div class="mainContainer">
        <div id="storeContainer">
            <h2>Enter Store</h2>
            <input type="text" id="address_input" placeholder="Store Address" />
            <button onclick="queryAddress()">Find Stores</button>

            <div id="storeList">STORE LIST</div>
        </div>

        <div id="groceryContainer" style="background-image: url('/static/images/map.png');">
        </div>
    </div>

    <div style="background-color: white;">
        <div id="queriedList" style="height: 250px; width: 100%;">
            <div id="dataTable">
                <!-- Header row -->
                <div class="row header-row">
                    <div class="dataCell">Item</div>
                    <div class="dataCell">Price</div>
                    <div class="dataCell">Store</div>
                    <div class="dataCell">Query Value</div>
                </div>

                <!-- Data rows will be injected here -->
                <div id="themIds"></div>
            </div>
        </div>
    </div>

    

    <script>
        let item_names = [];
        let item_prices = []
        let store_names = []
        let query_values = []
        let all_addresses = [];   // ðŸ”¹ added so queryAddress/displayAddresses work

        async function makeList(input){
            let element = document.getElementById("themIds");
            // context = "find/" + input
            
            await fetch("/test/" + input)
                .then(response => response.json())
                .then(data => {
                    // alert("Value from Flask: " + data.value);
                    console.log("RAW DATA:", data);
                    item_names.push(...data.Item_Name);
                    item_prices.push(...data.Item_Price);
                    store_names.push(...data.Store_Name);
                    query_values.push(...data.Query_Value);
                });

            let string = ""
            for(i = 0; i < item_names.length; i++) {
                str1 = "<h5 class=\"dataComponents\">" + item_names[i]+ "</h5>"
                str2 = "<h5 class=\"dataComponents\">"+ item_prices[i] + "</h5>"
                str3 = "<h5 class=\"dataComponents\">"+ store_names[i] + "</h5>"
                str4 = "<h5 class=\"dataComponents\">"+ query_values[i] + "</h5>"
                string += "<div class=\"comps\">" + str1 + str2 + str3 + str4 + "</div>";
            }

            element.innerHTML += string;
        }

        function queryAddress() {
            const context = document.getElementById("address_input");
            all_addresses.push(context.value);
            console.log(all_addresses + " " + context.value);
            context.value = "";
        }

        function displayAddresses() {
            const list = document.getElementById("storeList");

            if (all_addresses.length === 0) {
                list.innerHTML = "<p>No locations added.</p>";
                return;
            }

            list.innerHTML = all_addresses
                .map(addr => `<div><button onclick="addLocation('${addr}')">${addr}</button></div>`)
                .join("");

            console.log(list.innerHTML)
        }

        function addLocation(address) {
            console.log("Selected store:", address);
        }

        function searchGrocery() {
            const input = document.getElementById("searchIntake").value;
            console.log("Searching for:", input);
            makeList(input);
        }
    </script>
</body>
</html>
